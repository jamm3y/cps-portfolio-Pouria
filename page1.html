<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JavaScript Game</title>
    <style>
        body {
            background-color: #cce5ff;
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
            background-color: black;
        }
    </style>
</head>
<body>

<canvas id="gameCanvas" width="1000" height="800"></canvas>

<script>
/* ================= VARIABLES ================= */

let where = 0;
let camSensitivity = 2;

let playerPos = [1, 0, 0];

// Load image
let godImage = new Image();
godImage.src = "OGOD.png"; // must be in same folder

let god = [10, 0, 0, godImage];
let everything = [god];

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let keys = {};

/* ================= INPUT ================= */

document.addEventListener("keydown", e => {
    keys[e.key] = true;
});

document.addEventListener("keyup", e => {
    keys[e.key] = false;
});

/* ================= FUNCTIONS ================= */

function look() {
    if (keys["ArrowLeft"]) {
        where -= camSensitivity;
    }
    if (keys["ArrowRight"]) {
        where += camSensitivity;
    }

    where = (where + 180) % 360 - 180;

    let angleRad = where * Math.PI / 180;
    let moveX = Math.cos(angleRad);
    let moveZ = Math.sin(angleRad);

    if (keys["ArrowUp"]) {
        playerPos[0] += moveX;
        playerPos[2] += moveZ;
    }
    if (keys["ArrowDown"]) {
        playerPos[0] -= moveX;
        playerPos[2] -= moveZ;
    }
}

function render() {
    for (let entity of everything) {
        let dx = entity[0] - playerPos[0];
        let dz = entity[2] - playerPos[2];

        let distance = Math.sqrt(dx * dx + dz * dz);
        if (distance <= 0.01) continue;

        let angle = Math.atan2(dz, dx) * 180 / Math.PI;
        let relative = angle - where;
        relative = (relative + 180) % 360 - 180;

        let FOV = 90;
        if (Math.abs(relative) > FOV / 2) continue;

        let screenX = (relative / (FOV / 2)) * 500 + canvas.width / 2;
        let size = 600 / distance;

        ctx.drawImage(
            entity[3],
            screenX - size / 2,
            canvas.height / 2 - size / 2,
            size,
            size
        );
    }
}

/* ================= GAME LOOP ================= */

function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    look();
    render();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>

</body>
</html>
